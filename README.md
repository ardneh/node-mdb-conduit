This node modules makes MongoDB's (http://mongodb.org) aggregation pipeline
(henceforce `pipeline`) avaiable for use in NodeJS.

Potential uses
--------------
* Provide a common API to query data in an application (one DSL).
* Post-processing of data returned by MongoDB.
* Pre-processing of pipelines sent to MongoDB.
* Test out ideas for new pipeline functionality.
* Profile pipeline operations more easily.

Disclaimers
-----------
* This was initially put together as a very quick proof-of-concept so in it's
  current state it is not pretty.
* It is only going to build on *nix platforms for now.  "Linux" should work
  and OS X should be easy to make work if it does not already.
* This is the first time I've used gyp, so I am certain I could be doing some
  things better there.
* This is also my first native node module.  I want to be to compatible with
  v0.10 and v0.11/12.

Build Requirements
-----------
* Python
* scons
* The rest of the MongoDB build requirements
*  See [http://www.mongodb.org/about/contributors/tutorial/build-mongodb-from-source/]

Build Steps
-----------
Note: All of these will be rolled into bindings.gyp as time permits
* Setup a nodeenv.  You can skip this if you want to install globally, etc...
  `pip install nodeenv`
  `nodeenv --force .`
  `. bin/activate`
  `ln -s lib/node_modules node_modules`
  `npm install -g node-gyp`
* Clone the MongoDB source:
  `git clone -b v2.6 --depth 2 --single-branch https://github.com/mongodb/mongo src/third-party/mongo`
* Build some of the mongo libs we currently depend on.  This takes a while, up
  to ~25 minutes with -j 2, definitely use a larger number than 2 if you have
  more processors to spare.
  `cd src/third-party/mongo`
  `patch -p1 < ../patches/mongo/do_not_autoclean.patch`
  `time scons -j 2 mongos`
  `cd -`
* Now we can build the actual node module:
  `npm install`

TODO
----
* Move all of the pipeline code to it's own repo and have this downloand and
  build it.  The only code that should be in this package is the node glue.
*  If it is too difficult to copy the relevent mongodb source files over and
   build everything with gyp then at least compile MongoDB's buildinfo.cpp and
   call compilerFlags() in bindings.gyp to get the compiler flags for the
   pipeline.
* Run as many of MongoDB's unit tests as possible.
* Develop an pipeline agnostic set of tests that can be used for this and munge.
* Test out the C++ driver's json parser!  See if that is faster than going from
  v8 objects to bson.
*   See if maybe another version of it could be used to go from v8 to bson.
* Improve speed.  Re-time against mungedb-aggregate, but against bson data
  (no-conversion step).
*  Investigate what it would take for the bson builder / reader classes to
   handle json.
* Make it able to accept v8 objects, json and bson.
* Use thread pool instead of trying to make any part of the pipeline async,
  which is pretty much pointless because of $group and $sort).
* See if it would be easy to add a pipeline-version flag [2.4, 2.6].
* Build mongo with C++11 support: --c++11=C++11

High
----
* Try the https://github.com/mongodb/js-bson node module and if it's at least
  close to as fast as v8ToMongo, get rid of MongoV8Helpers. Otherwise, rename
  MongoV8Helpers to someone meaningful (all it does/should do is convert from
  V8 types <-> BSON).
* Move test cases to test/
* Make it extentable (DocumentSources, Pipeline, etc...) preferably both from
  C++ AND node (much lower priority).
* Enable veryfy(), *assert(),
* Try to re-use MongoDB's pipeline test cases.
* Remove #if 0 blocks from MongoV8Helpers.
* Rename v8ToMongo* to v8ToBson*. 
* Make using "copies" in gyp to copy over _all_ of the mongo cpp files we use
  (db/pipeline, ...) into src/mongo and add those new files to our sources.
*  Stop linking with ALL mongo libs.  We should be compiling everything we need
   directly.

Medium
------
* Only include (build) the files we actually need from MongoDB (mostly in
  pipeline/).
  - Do not actually link any MongoDB libraries.  Watch out for the one case
    where we need to include a file that is generated by mongo's build.
    Hopefully we won't need that for more than error_codes.[h|cpp].
* Provide our own DocumentSource based on node streams or something so we can
  pass items through a pipeline as they become available.  This is low priority 
  because $group and $sort will force the entire pipeline to be syncronous
  anyways.
* Make a base class for MongoDB's scripting V8Scope class
  (in mongo/scripting/engine_v8.*) that we can use for convertion V8 object to
  and from BSON.  Update: hoping this will no longer be needed.
  - Make the relevant items in src/mongo/scripting/v8_db.* either take the new
    base class instead of Scope* or make them templates so they can accept
    either (as long as in MongoDB and in our code only one set ever get
    instantiated.
